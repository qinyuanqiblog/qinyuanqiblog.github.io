(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{419:function(s,n,a){"use strict";a.r(n);var e=a(12),r=Object(e.a)({},(function(){var s=this,n=s._self._c;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("ul",[n("li",[n("p",[s._v("直接从幕布考过来的，懒得改排版了， 😄😄😄，")])]),s._v(" "),n("li",[n("p",[s._v("幕布地址： https://mubu.com/doc/_77_RCP9GG")])]),s._v(" "),n("li",[n("p",[s._v("前言")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("公司搬家了， 换了新的电脑， 感觉桌面有点空荡荡，想去搞几张高级的背景图片来装下13，于是便有了这个项目")])]),s._v(" "),n("li",[n("p",[s._v("经过一番谷歌，感觉比较喜欢"),n("a",{attrs:{href:"https://wallhaven.cc/toplist?page=2",target:"_blank",rel:"noopener noreferrer"}},[s._v("wallhaven"),n("OutboundLink")],1),s._v("这种风格的背景图，开始搞起 ~~~")])])])]),s._v(" "),n("li",[n("p",[s._v("搞搞搞")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("思路")]),s._v(" "),n("ul",[n("li",[n("ol",[n("li",[s._v("解析页面，分析页面结构，然后拿到图片地址")])])]),s._v(" "),n("li",[n("ol",{attrs:{start:"2"}},[n("li",[s._v("然后发起请求，只用写入本地")])])])])]),s._v(" "),n("li",[n("p",[s._v("具体操作")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("解析页面，分析页面结构，然后拿到图片地址，")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("缩略图的页面结构"),n("img",{attrs:{src:"https://api2.mubu.com/v3/document_image/62157013-083e-4ada-b9e3-e7099ee31107-2331693.jpg",alt:""}})])]),s._v(" "),n("li",[n("p",[s._v("详情图的页面结构"),n("img",{attrs:{src:"https://api2.mubu.com/v3/document_image/c3fa954c-c0be-44d6-aca7-f14ea5236be1-2331693.jpg",alt:""}})])]),s._v(" "),n("li",[n("p",[s._v("缩略图地址： "),n("a",{attrs:{href:"https://th.wallhaven.cc/small/rd/rd7dlq.jpg",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://th.wallhaven.cc/small/rd/rd7dlq.jpg"),n("OutboundLink")],1)])]),s._v(" "),n("li",[n("p",[s._v("大图地址： "),n("a",{attrs:{href:"https://w.wallhaven.cc/full/rd/wallhaven-rd7dlq.jpg",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://w.wallhaven.cc/full/rd/wallhaven-rd7dlq.jpg"),n("OutboundLink")],1)])]),s._v(" "),n("li",[n("p",[s._v("找规律")]),s._v(" "),n("ul",[n("li",[s._v("通过知道小图地址，找出大图地址，不同网站不同哦"),n("img",{attrs:{src:"https://api2.mubu.com/v3/document_image/88d4b1c7-a7c2-4eeb-b66b-5d4dd173b281-2331693.jpg",alt:""}})])])]),s._v(" "),n("li",[n("p",[s._v("找分页接口")]),s._v(" "),n("ul",[n("li",[n("img",{attrs:{src:"https://api2.mubu.com/v3/document_image/c9b50b15-d126-4a78-9c75-25f807b02180-2331693.jpg",alt:""}})])])])])]),s._v(" "),n("li",[n("p",[s._v("知道网站的布局和规律之后，我们就可以开始编码了")])]),s._v(" "),n("li",[n("p",[s._v("编码思路：")]),s._v(" "),n("ul",[n("li",[s._v("先把所有的缩略图都爬取出来，爬完之后，再按照每次10个 ，10秒一次去下载，然后写入本地")])])]),s._v(" "),n("li",[n("p",[s._v("具体步骤")]),s._v(" "),n("ul",[n("li",[n("p",[n("a",{attrs:{href:"https://expressjs.com/zh-cn/starter/generator.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("Express 应用程序生成器"),n("OutboundLink")],1),s._v("来构建一个express应用，具体步骤参考官网")])]),s._v(" "),n("li",[n("p",[s._v("需要使用的库")]),s._v(" "),n("ul",[n("li",[n("p",[n("a",{attrs:{href:"https://www.npmjs.com/package/consola",target:"_blank",rel:"noopener noreferrer"}},[s._v("consola"),n("OutboundLink")],1),s._v(" 让日志好看点，方便观赏")])]),s._v(" "),n("li",[n("p",[n("a",{attrs:{href:"https://www.npmjs.com/package/cheerio",target:"_blank",rel:"noopener noreferrer"}},[s._v("cheerio"),n("OutboundLink")],1),s._v(" node 版本的jquery，用来解析页面")])]),s._v(" "),n("li",[n("p",[n("a",{attrs:{href:"https://www.npmjs.com/package/axios",target:"_blank",rel:"noopener noreferrer"}},[s._v("axios"),n("OutboundLink")],1),s._v(" 发送请求，下载图片")])])])]),s._v(" "),n("li",[n("p",[s._v("核心代码")]),s._v(" "),n("ul",[n("li",[n("ol",[n("li",[s._v("发起请求，获取到缩略图的地址，然后存到一个数组里面"),n("img",{attrs:{src:"https://api2.mubu.com/v3/document_image/c65684ce-7c8a-4e50-bce4-9f065455cf2f-2331693.jpg",alt:""}})])])]),s._v(" "),n("li",[n("ol",{attrs:{start:"2"}},[n("li",[s._v("轮询，调用分页接口获取缩略图地址"),n("img",{attrs:{src:"https://api2.mubu.com/v3/document_image/44eb1bc1-8fd3-43bb-b06f-44ab83389e27-2331693.jpg",alt:""}})])])]),s._v(" "),n("li",[n("ol",{attrs:{start:"3"}},[n("li",[s._v("下载图片，然后存储到本地电脑，楼主使用万年window，穷😄"),n("img",{attrs:{src:"https://api2.mubu.com/v3/document_image/ac9552bd-cdc6-4c10-89bb-20926431e408-2331693.jpg",alt:""}})])])]),s._v(" "),n("li",[n("ol",{attrs:{start:"4"}},[n("li",[s._v("效果，美滋滋")])]),s._v(" "),n("ul",[n("li",[n("img",{attrs:{src:"https://api2.mubu.com/v3/document_image/7980e5ac-450c-43c1-bf8f-93f91080aa7c-2331693.jpg",alt:""}})]),s._v(" "),n("li",[s._v("5核心代码")])])])])])])])])])])])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("const reptileUrl = 'https://wallhaven.cc/toplist?page='\n// 本地存储路径\nconst saveDir = 'E:/myExpressDownload/toplist3/'\nlet currentPage = 1\nconst maxPage = 2\n\nconst imgUrlList = []\n\n\ninit()\n\n/**\n * 爬取主程序入口\n */\nasync function init() {\n    log.info('主程序开始启动，请您耐心等待~')\n    log.info(`开始爬取${reptileUrl}的图片`)\n    log.info(`文件将会被保存到以下地址中：${saveDir}`)\n\n    // 判断本地存储文件夹是否存在\n    if (!fs.existsSync(saveDir)) {\n        log.info('目标文件不存在，开始创建新的文件夹~')\n        fs.mkdirSync(saveDir);\n    }\n\n    if (currentPage > maxPage) {\n        log.error('超出最大页数，停止收集源数据，开始爬取图片~')\n        try {\n            const downloadTimer = setInterval(() => {\n                if(!imgUrlList.length){\n                    log.error('没有更多了，收工了~~~~')\n                    clearInterval(downloadTimer)\n                    return false\n                }\n                log.success('开始轮询下载图片~')\n                downloadPicture(imgUrlList.splice(0, 10))\n            }, 10000);\n        } catch (error) {\n            log.error(`downloadPicture fail===>`, error)\n        }\n        \n        // const downloadTimer  = setInterval(() => {\n        //     if(!imgUrlList.length){\n        //         log.error('没有图片了， 终于干完活了， 累死了~~~')\n        //         clearInterval(downloadTimer)\n        //     }\n        //     log.success('开始轮询下载图片咯~')\n        //     downloadPicture(imgUrlList.splice(0, 10))\n        // }, 20000);\n        return false\n    }\n    try {\n        log.info(`开始爬取第${currentPage}页`)\n        const websiteHtml = await axiosRequest.get(`${reptileUrl}${currentPage}`)\n        const html = websiteHtml\n        const $ = cheerio.load(html);\n        $('.thumb img').each((i, v) => {\n            const smallUrl =  v.attribs['data-src'] ||  v.attribs.src\n            const urlArray = smallUrl.split('/')\n            const fileName = urlArray[urlArray.length-1]\n            const fullUrl = `https://w.wallhaven.cc/full/${fileName.substring(0, 2)}/wallhaven-${fileName}`\n            smallUrl && imgUrlList.push({\n                        smallUrl: smallUrl,\n                        fullUrl: fullUrl,\n                        fileName\n                    })\n            \n        })\n\n        log.error(`imgUrlList==>`, imgUrlList)\n        sleep(init)\n    } catch (error) {\n        log.error(`爬取错误，错误信息如下==>`, error)\n    }\n}\n\nfunction sleep(callback) {\n    currentPage++\n    const sleepTimeout = commonUtils.getRandomNumber(1, 10)\n    let copyTimeout = sleepTimeout\n    log.info(`爬太多了，有点累了，休息${sleepTimeout}秒，后再继续😄`)\n    const logTimer = setInterval(() => {\n        if (copyTimeout <= 1) {\n            clearInterval(logTimer)\n        }\n        log.success(`倒计时  ${--copyTimeout}   秒后开始继续干活~`)\n    }, 1000);\n    setTimeout(() => {\n        typeof callback === 'function'  &&  callback()\n    }, sleepTimeout * 1000);\n}\n\nasync function findPicture(aTagArray) {\n    log.info('开始解析图片内容~')\n    const array = aTagArray.map(v => axiosRequest.get(v))\n    return Promise.all(array)\n}\n\n\nfunction downloadPicture(pictureArray) {\n    log.info('开始发送请求下载图片~')\n    return pictureArray.reduce((accumulator, currentValue, currentIndex, array) => {\n        console.log(currentValue.fullUrl, 'currentValue.fullUrl')\n        const promise = axiosRequest.get(currentValue.fullUrl, {\n            responseType: 'stream'\n        }).then(res => {\n            const result = res.pipe(fs.createWriteStream(`${saveDir}${currentValue.fileName}`))\n            log.success(`成功保存图片到本地，保存位置==>${saveDir}${currentValue.fileName}`)\n        })\n        accumulator.push(promise)\n        return accumulator\n    }, [])\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br"),n("span",{staticClass:"line-number"},[s._v("79")]),n("br"),n("span",{staticClass:"line-number"},[s._v("80")]),n("br"),n("span",{staticClass:"line-number"},[s._v("81")]),n("br"),n("span",{staticClass:"line-number"},[s._v("82")]),n("br"),n("span",{staticClass:"line-number"},[s._v("83")]),n("br"),n("span",{staticClass:"line-number"},[s._v("84")]),n("br"),n("span",{staticClass:"line-number"},[s._v("85")]),n("br"),n("span",{staticClass:"line-number"},[s._v("86")]),n("br"),n("span",{staticClass:"line-number"},[s._v("87")]),n("br"),n("span",{staticClass:"line-number"},[s._v("88")]),n("br"),n("span",{staticClass:"line-number"},[s._v("89")]),n("br"),n("span",{staticClass:"line-number"},[s._v("90")]),n("br"),n("span",{staticClass:"line-number"},[s._v("91")]),n("br"),n("span",{staticClass:"line-number"},[s._v("92")]),n("br"),n("span",{staticClass:"line-number"},[s._v("93")]),n("br"),n("span",{staticClass:"line-number"},[s._v("94")]),n("br"),n("span",{staticClass:"line-number"},[s._v("95")]),n("br"),n("span",{staticClass:"line-number"},[s._v("96")]),n("br"),n("span",{staticClass:"line-number"},[s._v("97")]),n("br"),n("span",{staticClass:"line-number"},[s._v("98")]),n("br"),n("span",{staticClass:"line-number"},[s._v("99")]),n("br"),n("span",{staticClass:"line-number"},[s._v("100")]),n("br"),n("span",{staticClass:"line-number"},[s._v("101")]),n("br"),n("span",{staticClass:"line-number"},[s._v("102")]),n("br"),n("span",{staticClass:"line-number"},[s._v("103")]),n("br"),n("span",{staticClass:"line-number"},[s._v("104")]),n("br"),n("span",{staticClass:"line-number"},[s._v("105")]),n("br"),n("span",{staticClass:"line-number"},[s._v("106")]),n("br"),n("span",{staticClass:"line-number"},[s._v("107")]),n("br"),n("span",{staticClass:"line-number"},[s._v("108")]),n("br"),n("span",{staticClass:"line-number"},[s._v("109")]),n("br"),n("span",{staticClass:"line-number"},[s._v("110")]),n("br"),n("span",{staticClass:"line-number"},[s._v("111")]),n("br"),n("span",{staticClass:"line-number"},[s._v("112")]),n("br"),n("span",{staticClass:"line-number"},[s._v("113")]),n("br")])]),n("ul",[n("li",[n("p",[s._v("完整代码")]),s._v(" "),n("ul",[n("li",[s._v("https://github.com/qinyuanqiblog/express-demo")])])]),s._v(" "),n("li",[n("p",[s._v("结束语")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("本文如有错误，欢迎指正，非常感谢")])]),s._v(" "),n("li",[n("p",[s._v("觉得有用的老铁，点个双击，小红心走一波")])]),s._v(" "),n("li",[n("p",[s._v("欢迎灌水，来呀，互相伤害哈 o(∩_∩)o 哈哈")])])])])])])}),[],!1,null,null,null);n.default=r.exports}}]);